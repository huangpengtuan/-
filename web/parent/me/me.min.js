(function(angular){'use strict';angular.module('Mme',['ngRoute']).directive('onFinishRender',function($timeout){return{restrict:'A',link:function(scope,element,attr){if(scope.$last===true){$timeout(function(){scope.$emit('ngRepeatFinished')})}}}}).config(['$routeProvider',function($routeProvider){$routeProvider .when('/my/',{templateUrl:'me/me.html',controller:'meCtl'}).when('/phone/',{templateUrl:'me/telephone.html',controller:'phoneCtl'}).when('/authen/',{templateUrl:'me/authen.html',controller:'authenCtl'}).when('/editChilds/',{templateUrl:'me/editChilds.html',controller:'editChildsCtl'}).when('/mychild/:ID/:oldID',{templateUrl:'me/mychild.html',controller:'mychildCtl'}).when('/modifyChild/:ID',{templateUrl:'me/modifyChild.html',controller:'modifyChildsCtl'}).when('/MyOrders/',{templateUrl:'me/MyOrders.html',controller:'MyOrdersCtl'}).when('/OrderDetails/:ID',{templateUrl:'me/OrderDetails.html',controller:'OrderDetailsCtl'}).when('/refundApply/:ID',{templateUrl:'me/refundApply.html',controller:'refundApplyCtl'}).when('/RefundDetails/:ID',{templateUrl:'me/RefundDetails.html',controller:'RefundDetailsCtl'}).when('/Evaluate/:ID',{templateUrl:'me/Evaluate.html',controller:'EvaluateCtl'}).when('/MyCollect/',{templateUrl:'me/MyCollect.html',controller:'MyCollectCtl'})}]).controller('meCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.avatar='';$scope.name='';$scope.vip_type='';$scope.sex='';$scope.score='';$scope.balance='';$scope.mobile='';$scope.verify='';$.post("/p/getMyInfo",{},function(data){$scope.avatar=data.avatar;$scope.name=data.name;$scope.parentVip=data.parentVip;$scope.sex=data.sex;$scope.score=data.score;$scope.balance=data.balance;$scope.verify=data.is_id_card_verify;if(!data.mobile){$scope.mobile='绑定手机'}else if(data.mobile){$scope.mobile=data.mobile}$scope.$apply()});$scope.authens=function(veri){var verifys=veri;if(verifys==2){alert("您已经通过实名认证，无需再认证")}else{$location.path('/authen/')}}}]).controller('phoneCtl',['$scope',function($scope){$scope.statetext='';$scope.statetab='';$scope.telephone='';$.post("/p/getMyInfo",{},function(data){if(!data.mobile){$scope.statetext='未绑定';$scope.statetab='绑定手机';$scope.telephone='手机号码'}else if(data.mobile){$scope.statetext=data.mobile;;$scope.statetab='更换绑定手机';$scope.telephone='改绑手机号码'}$scope.$apply()});var countdown=60;var settime=function(obj){if(countdown==0){obj.attr('disabled',false);obj.val("获取验证码");countdown=60;return}else{obj.attr('disabled',true);obj.val("重新发送("+countdown+")");countdown-=1}setTimeout(function(){settime(obj)},1000)};var sendemail=function(){var obj=$("#btnsend");settime(obj)};$scope.sendSms=function(){var mobiles=$('.rCinputI').val();$.ajax({type:"post",url:"/c/sendSms",data:{"mobile":mobiles,},datatype:"json",success:function(data){sendemail()}})};$scope.bindmobile=function(){var mobiles=$('.rCinputI').val();var sendtext=$('.yanzhengma').val();$.ajax({type:"post",url:"/c/wdForPhone",data:{"mobile":mobiles,"mobileCode":sendtext,},datatype:"json",success:function(data){alert(data.msg);if(data.isSuccess){location.reload()}}})}}]).controller('authenCtl',['$scope',function($scope){$scope.submitAuthen=function(){var formData=new FormData($("#withdrawForm")[0]);$.ajax({type:"post",url:"/c/realNameAuthentication",data:formData,datatype:"json",async:false,cache:false,contentType:false,processData:false,success:function(data){alert(data.msg);location.reload()}})}}]).controller('editChildsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.creatChilds=function(){var ChildsData=$('#CNdatas').serializeArray();$.ajax({type:"post",url:"/childrenInfo/createChildrenInfo",data:{"c.name":ChildsData[0].value,"c.age":ChildsData[1].value,"c.sex":ChildsData[2].value,"c.mobile":ChildsData[3].value,"c.explain":ChildsData[4].value,},datatype:"json",success:function(data){alert(data.msg);if(data.isSuccess){location.reload()}}})};$scope.goback=function(){window.history.back()}}]).controller('mychildCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.currisID=$routeParams.ID;$scope.oldID=$routeParams.oldID;$scope.Mychildlist='';$scope.ishavechild='';tabsfn('Admintabs','.Admintabs','.DY-tabs01','activeFind');if($scope.currisID==0){$.ajax({type:"post",url:"/childrenInfo/getChildrenList",data:{},datatype:"json",success:function(data){$scope.Mychildlist=data.object;if(data.object.length==0){$scope.ishavechild=true}else{$scope.ishavechild=false}$scope.$apply()}})}else if($scope.currisID>0){$.ajax({type:"post",url:"/childrenInfo/getChildrenListByCourse",data:{'courseId':$scope.currisID},datatype:"json",success:function(data){$scope.Mychildlist=data.object;console.log($scope.Mychildlist);if(data.object.length==0){$scope.ishavechild=true}else{$scope.ishavechild=false}$scope.$apply()}})}$scope.goEdit=function(){$location.path('/editChilds/')};$scope.goback=function(){window.history.back()};$scope.thisDefaults=function(defaultindex,childlistsid){var indexss=defaultindex;$.ajax({type:"post",url:"/childrenInfo/setDefaultInfo",data:{'childrenId':childlistsid},datatype:"json",success:function(data){$.ajax({type:"post",url:"/childrenInfo/getChildrenList",data:{},datatype:"json",success:function(data){$scope.Mychildlist=data.object;$scope.$apply()}});$('.icon-Uncheck').removeClass('default-Active');$('.icon-Uncheck').eq(indexss-1).addClass('default-Active')}})};$scope.deletechilds=function(childlistsid){$.ajax({type:"post",url:"/childrenInfo/deleteChildrenInfo",data:{'childrenId':childlistsid},datatype:"json",success:function(data){$.ajax({type:"post",url:"/childrenInfo/getChildrenList",data:{},datatype:"json",success:function(data){$scope.Mychildlist=data.object;$scope.$apply()}});scartdelete('.Mychilds-container')}})};$scope.ChoiceChilds=function(childlistsid){if($scope.oldID==0){$scope.oldID=null}$.ajax({type:"post",url:"/courseOrderChildren/addChildrenToCourse",data:{'childrenId':childlistsid,'courseId':$scope.currisID,'oldChildrenId':$scope.oldID},datatype:"json",success:function(data){window.history.back()}})};$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){scartdelete('.Mychilds-container')})}]).controller('modifyChildsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.childsID=$routeParams.ID;$scope.childsData='';$.ajax({type:"post",url:"/childrenInfo/getChildrenById",data:{"childrenId":$scope.childsID,},datatype:"json",success:function(data){$scope.childsData=data.object;$scope.$apply()}});$scope.modifyChilds=function(){var ChildsData=$('#CNdatas').serializeArray();$.ajax({type:"post",url:"/childrenInfo/editChildrenInfo",data:{"c.id":$scope.childsID,"c.name":ChildsData[0].value,"c.age":ChildsData[1].value,"c.sex":ChildsData[2].value,"c.mobile":ChildsData[3].value,"c.explain":ChildsData[4].value,},datatype:"json",success:function(data){alert(data.msg);if(data.isSuccess){window.history.back()}}})};$scope.goback=function(){window.history.back()}}]).controller('MyOrdersCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){tabsfn('DY-tabs','.DY-tabs','.DY-tabs01','SCactive');var cancalReason=document.getElementsByClassName('cancalReason');for(var i=0;i<cancalReason.length;i+=1){cancalReason[i].onclick=function(){var indexx=$('.cancalReason').index($(this));for(var i=0;i<cancalReason.length;i+=1){$('.icon-Uncheck').removeClass('checksActive')}$('.icon-Uncheck').eq(indexx).addClass('checksActive')}}$scope.cancalReasonFadein=function(Oid){$('.cancalState').fadeIn();localStorage.setItem("DeleteOrderId",Oid)};$scope.cancalReasonFadeOut=function(){$('.cancalState').fadeOut()};$scope.goOrderDetails=function(OState,Oid){if(OState==0||OState==1||OState==2||OState==3||OState==4){$location.path('/OrderDetails/'+Oid)}else{$location.path('/RefundDetails/'+Oid)}};$scope.goEvaluate=function(Oid){$location.path('/Evaluate/'+Oid)};$scope.InsureDelete=function(){var Oid=localStorage.getItem("DeleteOrderId");var cancelReason=$('.checksActive').siblings().html();$.ajax({type:"post",url:"/order/cancelOrder",data:{"orderId":Oid,"cancelReason":cancelReason},datatype:"json",success:function(data){$.ajax({type:"post",url:"/order/getOrderList",data:{"pageIndex":1,"pageSize":20},datatype:"json",success:function(data){console.log(data);$scope.carmdAllLsits=data.object.list;console.log($scope.carmdAllLsits);$scope.$apply()}});$('.cancalState').fadeOut()}})};$scope.carmdAllLsits='';localStorage.setItem("orderStates",'');$.ajax({type:"post",url:"/order/getOrderList",data:{"pageIndex":1,"pageSize":20},datatype:"json",success:function(data){$('.spinner').fadeOut();$scope.carmdAllLsits=data.object.list;$scope.$apply()}});$scope.paycurri=function(orderIds){localStorage.setItem("orderIds",orderIds);$location.path('/ACinsure/')};var CDtabs=document.getElementsByClassName('MyOrders-tabs');for(var i=0;i<CDtabs.length;i+=1){CDtabs[i].onclick=function(){var indexx=$('.MyOrders-tabs').index($(this));for(var i=0;i<CDtabs.length;i+=1){$('.MyOrders-tabs').removeClass('MOactive');$('.MyOrders-tabs01').removeClass("active")}if(indexx==0){$('.spinner').fadeIn();$.ajax({type:"post",url:"/order/getOrderList",data:{"pageIndex":1,"pageSize":20},datatype:"json",success:function(data){$scope.carmdAllLsits=data.object.list;$scope.$apply()}});localStorage.setItem("orderStates",'')}else if(indexx==1||indexx==2||indexx==3){$('.spinner').fadeIn();$.ajax({type:"post",url:"/order/getOrderList",data:{"pageIndex":1,"pageSize":20,"status":indexx-1,},datatype:"json",success:function(data){$scope.carmdAllLsits=data.object.list;$scope.$apply()}});localStorage.setItem("orderStates",indexx-1)}pageSizes=20;$('.spinner').fadeOut();$(this).addClass('MOactive');$('.MyOrders-tabs01').eq(indexx).addClass("active")}}var pageSizes=20;$(window).bind("scroll",function(){if($(document).scrollTop()+$(window).height()==$(document).height()){$('.spinner').fadeIn();var orderStates=localStorage.getItem("orderStates");pageSizes+=20;$.ajax({type:"post",url:"/order/getOrderList",data:{"pageIndex":1,"pageSize":pageSizes,"status":orderStates,},datatype:"json",success:function(data){$('.spinner').fadeOut();$scope.carmdAllLsits=data.object.list;$scope.$apply()}})}});}]).controller('OrderDetailsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var Oid=$routeParams.ID;$scope.OrderListDetail='';$scope.failureTimeH='';$scope.failureTimeM='';$.ajax({type:"post",url:"/order/getOrderList",data:{"orderId":Oid,},datatype:"json",success:function(data){$scope.OrderListDetail=data.object.list[0];$scope.failureTimeH=parseInt(data.object.list[0].failureTime/1000/60/60);$scope.failureTimeM=parseInt(((data.object.list[0].failureTime/1000/60/60)-$scope.failureTimeH)*60);$scope.$apply()}});setInterval(function(){$.ajax({type:"post",url:"/order/getOrderList",data:{"orderId":Oid,},datatype:"json",success:function(data){$scope.failureTimeH=parseInt(data.object.list[0].failureTime/1000/60/60);$scope.failureTimeM=parseInt(((data.object.list[0].failureTime/1000/60/60)-$scope.failureTimeH)*60);$scope.$apply()}})},60000);var cancalReason=document.getElementsByClassName('cancalReason');for(var i=0;i<cancalReason.length;i+=1){cancalReason[i].onclick=function(){var indexx=$('.cancalReason').index($(this));for(var i=0;i<cancalReason.length;i+=1){$('.icon-Uncheck').removeClass('checksActive')}$('.icon-Uncheck').eq(indexx).addClass('checksActive')}}$scope.cancalReasonFadein=function(Oid){$('.cancalState').fadeIn();localStorage.setItem("DeleteOrderId",Oid)};$scope.cancalReasonFadeOut=function(){$('.cancalState').fadeOut()};$scope.InsureDelete=function(){var Oid=localStorage.getItem("DeleteOrderId");var cancelReason=$('.checksActive').siblings().html();$.ajax({type:"post",url:"/order/cancelOrder",data:{"orderId":Oid,"cancelReason":cancelReason},datatype:"json",success:function(data){$('.cancalState').fadeOut();alert(data.msg);$.ajax({type:"post",url:"/order/getOrderList",data:{"orderId":Oid,},datatype:"json",success:function(data){$scope.OrderListDetail=data.object.list[0];$scope.$apply()}})}})};$scope.goEvaluate=function(Oid){$location.path('/Evaluate/'+Oid)}}]).controller('refundApplyCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var HandFilmframe01=document.getElementsByClassName('HandFilmframe01');var HandFilmframe02=document.getElementsByClassName('HandFilmframe02');for(var i=0;i<HandFilmframe01.length;i+=1){HandFilmframe01[i].onclick=function(){var indexx=$('.HandFilmframe01').index($(this));for(var i=0;i<HandFilmframe01.length;i+=1){$('.HSC01').removeClass('checksActive')}$('.HSC01').eq(indexx).addClass('checksActive');$('#chulistate').val($('.HSC01-text').eq(indexx).html());$('.HandleState01').fadeOut()}}for(var i=0;i<HandFilmframe02.length;i+=1){HandFilmframe02[i].onclick=function(){var indexx=$('.HandFilmframe02').index($(this));for(var i=0;i<HandFilmframe02.length;i+=1){$('.HSC02').removeClass('checksActive')}$('.HSC02').eq(indexx).addClass('checksActive');$('#tuikuanR').val($('.HSC02-text').eq(indexx).html())}}$scope.HFframe01fadeIn=function(){$('.HandleState01').fadeIn()};$scope.HFframe02fadeIn=function(){$('.HandleState02').fadeIn()};$scope.HFframe02fadeOut=function(){$('.HandleState02').fadeOut();$('#tuikuanR').val('请选择')};$scope.HFframe02fadeOutR=function(){$('.HandleState02').fadeOut()}}]).controller('RefundDetailsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.forceStop=function(){$('.HandleState02').fadeIn()};$scope.cancelForceStop=function(){$('.HandleState02').fadeOut()};$scope.insureForceStop=function(){$('.HandleState02').fadeOut();$('.HandleState01').fadeIn()};$scope.successForceStop=function(){$('.HandleState01').fadeOut()}}]).controller('EvaluateCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var Oid=$routeParams.ID;$scope.goback=function(){window.history.back()};var getStartFn=function(iss,a,b,c,d){var curriStart01=$(a).eq(iss).find(c);var Ev_Start01=$(a).eq(iss).find(d);for(var i=0;i<curriStart01.length;i+=1){curriStart01[i].onclick=function(){var indexx=curriStart01.index($(this));for(var i=0;i<Ev_Start01.length;i+=1){Ev_Start01[i].src="img/start0.png"}for(var i=0;i<=indexx;i+=1){Ev_Start01[i].src="img/start10.png"}$(this).siblings(b).html($(this).attr("data-grade"))}}};$scope.carmdAllLsits='';$.ajax({type:"post",url:"/courseEvaluate/evaluate",data:{"orderId":Oid,},datatype:"json",success:function(data){$scope.carmdAllLsits=data.object;$scope.$apply()}});$scope.info=[];var TTTT="";$scope.ReleaseEva=function(){var $index=$scope.carmdAllLsits.length;for(var i=0;i<$index;i+=1){$scope.info.splice(i,0,{"explain":$('.Ev_textareaIn').eq(i).val(),"serviceScore":$('.curriStartgrad02').eq(i).html(),"qualityScore":$('.curriStartgrad01').eq(i).html(),"orderItemId":$('.MO-listTop').eq(i).attr("data-orderItemId")})}TTTT=JSON.stringify($scope.info);$.ajax({type:"post",url:"/courseEvaluate/publishEvaluate",data:{"evaluates":TTTT,},datatype:"json",success:function(data){alert(data.msg);if(data.isSuccess){$location.path('/MyOrders/')}$scope.$apply()}})};$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){for(var i=0;i<$scope.carmdAllLsits.length;i+=1){getStartFn(i,'.qualityScore','.curriStartgrad01','.curriStart01','.Ev_Start01');getStartFn(i,'.serviceScore','.curriStartgrad02','.curriStart02','.Ev_Start02')}})}]).controller('MyCollectCtl',['$scope',function($scope){$scope.goback=function(){window.history.back()};$scope.CollectList='';$.ajax({type:"post",url:"/favorite/getFavoriteList",data:{},datatype:"json",success:function(data){$scope.CollectList=data.object;$scope.$apply()}});$scope.CollectDelete=function(id){$.ajax({type:"post",url:"/favorite/deleteFavorite",data:{"favoriteId":id},datatype:"json",success:function(data){$.ajax({type:"post",url:"/favorite/getFavoriteList",data:{},datatype:"json",success:function(data){$scope.CollectList=data.object;$scope.$apply()}});scartdelete('.MyCollect-container')}})};$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){scartdelete('.MyCollect-container')})}])})(angular);