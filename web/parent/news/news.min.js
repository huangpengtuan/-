(function(angular){'use strict';angular.module('Mnews',['ngRoute']).directive('onFinishRender',function($timeout){return{restrict:'A',link:function(scope,element,attr){if(scope.$last===true){$timeout(function(){scope.$emit('ngRepeatFinished')})}}}}).config(['$routeProvider',function($routeProvider){$routeProvider .when('/news/',{templateUrl:'news/news.html',controller:'newsCtl'}).when('/kedanDetails/:ID',{templateUrl:'kedan/kedanDetails.html',controller:'kedanDetailsCtl'}).when('/SeeClass/:ID',{templateUrl:'kedan/SeeClass.html',controller:'SeeClassCtl'}).when('/SCDetail/:ID',{templateUrl:'kedan/SeeClassDetails.html',controller:'SCDetailCtl'}).when('/StopClass/:ID',{templateUrl:'kedan/StopClass.html',controller:'StopClassCtl'}).when('/dynamic/:State',{templateUrl:'news/dynamic.html',controller:'dynamicCtl'}).when('/AllClassDe/:ID',{templateUrl:'news/AllClassDe.html',controller:'AllClassDeCtl'}).when('/LDetai01/:ID',{templateUrl:'news/LessonsDetails01.html',controller:'LDetai01Ctl'}).when('/LDetai03/:ID',{templateUrl:'news/LessonsDetails03.html',controller:'LDetai03Ctl'}).when('/SingleClassDetail/:ID',{templateUrl:'news/SingleClassDetail.html',controller:'SingleClassDetailCtl'})}]).controller('newsCtl',['$scope','$route','$routeParams','$location',function($scope,$route,$routeParams,$location){var PTNumber=1;var PTSize=30;var newstabs=document.getElementsByClassName("newstabs");for(var i=0;i<newstabs.length;i+=1){newstabs[i].onclick=function(){var indexx=$(".newstabs").index($(this));for(var i=0;i<newstabs.length;i+=1){$(".newstabs").removeClass("active");$(".newstabs1").removeClass("active")}$(this).addClass("active");$(".newstabs1").eq(indexx).addClass("active")}}$scope.newslist=0;$.ajax({type:"post",url:"/c/chat",data:{},datatype:"json",success:function(data){$scope.newslist=data;$scope.$apply()}});$scope.teatherlist='';$.ajax({type:"post",url:"/p/getFriendsByParent",data:{"pageNumber":1,"pageSize":30,},datatype:"json",success:function(data){$scope.teatherlist=data.list;$scope.$apply()}});$(window).bind("scroll",function(){if($(document).scrollTop()+$(window).height()>$(document).height()+40){PTSize+20;$.ajax({type:"post",url:"/p/getFriendsByParent",data:{"pageNumber":PTNumber,"pageSize":PTSize,},datatype:"json",success:function(data){$scope.teatherlist=data.list;$scope.$apply()}})}});$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){var SingleOnOff=document.getElementsByClassName("SingleClass-right");for(var i=0;i<SingleOnOff.length;i+=1){var a=1;SingleOnOff[i].onclick=function(){a+=1;var indexx=$(".SingleClass-right").index($(this));for(var i=0;i<SingleOnOff.length;i+=1){$(".SingleDetails").slideUp("fast");$(".onoroff-open").addClass("opentxt");$(".onoroff-Close").removeClass("opentxt");$('.showorhide').removeClass("showorhide-active")}if(a%2==0){$(".SingleDetails").eq(indexx).stop(true,false).slideToggle("slow");$(".onoroff-open").eq(indexx).toggleClass("opentxt");$(".onoroff-Close").eq(indexx).toggleClass("opentxt");$('.showorhide').eq(indexx).toggleClass("showorhide-active")}}}});$scope.kedanlist='';$scope.kedanshow=function(id){var TeatherID=id;$.ajax({type:"post",url:"/c/curriculum/getCurriculumList",data:{"pageNumber":1,"pageSize":999,"targetId":TeatherID,},datatype:'json',success:function(data){$scope.kedanlist=data.content.list;$scope.$apply()}})};$scope.stateChange=function(id,state){var kedanID=id;var states=state;$.ajax({type:"post",url:"/c/curriculum/updateCurriculumState",data:{"currId":kedanID,"stateCode":states,},datatype:"json",success:function(data){window.location.reload()}})};$scope.refuse=function(id){var kedanID=id;$.ajax({type:"post",url:"/c/curriculum/refuseCurriculum",data:{"currId":kedanID,},datatype:"json",success:function(data){window.location.reload()}})};$scope.assess=function(tid,cid,iss,issadd){var teatherID=tid;var kedanID=cid;if(iss==0){$location.path('/assIni/'+teatherID+'/'+kedanID)}else if(iss==1&&issadd==0){$location.path('/assAgain/'+teatherID+'/'+kedanID)}}}]).controller('kedanDetailsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var currId=$routeParams.ID;$scope.typeText='';$scope.studentName='';$scope.subjectText='';$scope.grade='';$scope.hour_subsidy='';$scope.total_hours='';$scope.frequency='';$scope.placeText='';$scope.address='';$scope.order_amount='';$scope.penaltyAmount='';$scope.in_time='';$scope.memo='';$scope.state='';$scope.currId=currId;$.ajax({type:"post",url:"/c/curriculum/getCurriculumInfo",data:{"currId":currId},datatype:"json",success:function(data){$scope.typeText=data.object.typeText;$scope.studentName=data.object.student_name;$scope.subjectText=data.object.subjectText;$scope.grade=data.object.grade;$scope.hour_subsidy=data.object.hour_subsidy;$scope.total_hours=data.object.total_hours;$scope.frequency=data.object.frequency;$scope.placeText=data.object.placeText;$scope.address=data.object.address;$scope.order_amount=data.object.order_amount;$scope.penaltyAmount=data.object.penaltyAmount;$scope.in_time=data.object.in_time;$scope.memo=data.object.memo;$scope.state=data.object.state;$scope.$apply()}});$scope.stateChange=function(state){var states=state;$.ajax({type:"post",url:"/c/curriculum/updateCurriculumState",data:{"currId":currId,"stateCode":states,},datatype:"json",success:function(data){$location.path('/dynamic/'+1);$scope.$apply()}})}}]).controller('SeeClassCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var currId=$routeParams.ID;$scope.keciList='';$.ajax({type:"post",url:"/c/curriculumClass/getClassListBycurr",data:{"currId":currId,},datatype:"json",success:function(data){$scope.keciList=data.object;$scope.$apply()}});$scope.responseClass=function(classId,state){var states=state;var classId=classId;$.ajax({type:"post",url:"/c/curriculumClass/parentCheckClass",data:{"classId":classId,"state":states,},datatype:"json",success:function(data){if(state==3){alert("您已同意该课次")}else if(state==4){alert("您拒绝了该课次")}window.location.reload();$scope.$apply()}})}}]).controller('SCDetailCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var classId=$routeParams.ID;$.ajax({type:"post",url:"/c/curriculumClass/getClassInfo",data:{"classId":classId,},datatype:"json",success:function(data){$scope.kecis=data.object;$scope.$apply()}})}]).controller('StopClassCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var currId=$routeParams.ID;$scope.submitResure=function(){var resure=$("textarea").val();if(resure){$.ajax({type:"post",url:"/c/curriculum/updateCurriculumState",data:{"currId":currId,"stateCode":14,"stopReason":resure,},datatype:"json",success:function(data){alert("协商请求已发送，请耐心等待老师回复");$location.path('/dynamic/'+1);$scope.$apply()}})}else{alert("请填写您中止的原因")}}}]).controller('dynamicCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var state1234=$routeParams.State;var CDtabs=document.getElementsByClassName('DY-tabs');for(var i=0;i<CDtabs.length;i+=1){for(var i=0;i<CDtabs.length;i+=1){$('.DY-tabs').removeClass('SCactive');$('.DY-tabs01').removeClass("active")}$('.DY-tabs').eq(state1234).addClass('SCactive');$('.DY-tabs01').eq(state1234).addClass("active")}tabsfn('DY-tabs','.DY-tabs','.DY-tabs01','SCactive');var PTNumber=1;var PTSize=30;$scope.teatherlist='';$.ajax({type:"post",url:"/p/getFriendsByParent",data:{"pageNumber":1,"pageSize":30,},datatype:"json",success:function(data){$scope.teatherlist=data.list;$scope.$apply()}});$(window).bind("scroll",function(){if($(document).scrollTop()+$(window).height()==$(document).height()){PTSize+=20;$.ajax({type:"post",url:"/p/getFriendsByParent",data:{"pageNumber":PTNumber,"pageSize":PTSize,},datatype:"json",success:function(data){$scope.teatherlist=data.list;$scope.$apply()}})}});$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){var SingleOnOff=document.getElementsByClassName("SingleClass-right");for(var i=0;i<SingleOnOff.length;i+=1){var a=1;SingleOnOff[i].onclick=function(){a+=1;var indexx=$(".SingleClass-right").index($(this));for(var i=0;i<SingleOnOff.length;i+=1){$(".SingleDetails").slideUp("fast");$(".onoroff-open").addClass("opentxt");$(".onoroff-Close").removeClass("opentxt");$('.showorhide').removeClass("showorhide-active")}if(a%2==0){$(".SingleDetails").eq(indexx).stop(true,false).slideToggle("slow");$(".onoroff-open").eq(indexx).toggleClass("opentxt");$(".onoroff-Close").eq(indexx).toggleClass("opentxt");$('.showorhide').eq(indexx).toggleClass("showorhide-active")}}}});$scope.kedanlist='';$scope.kedanshow=function(id){var TeatherID=id;$.ajax({type:"post",url:"/c/curriculum/getCurriculumList",data:{"pageNumber":1,"pageSize":999,"targetId":TeatherID,},datatype:'json',success:function(data){$scope.kedanlist=data.content.list;$scope.$apply()}})};$scope.stateChange=function(id,state){var kedanID=id;var states=state;$.ajax({type:"post",url:"/c/curriculum/updateCurriculumState",data:{"currId":kedanID,"stateCode":states,},datatype:"json",success:function(data){$location.path('/dynamic/'+1)}})};$scope.refuse=function(id){var kedanID=id;$.ajax({type:"post",url:"/c/curriculum/refuseCurriculum",data:{"currId":kedanID,},datatype:"json",success:function(data){$location.path('/dynamic/'+1)}})};$scope.assess=function(tid,cid,iss,issadd){var teatherID=tid;var kedanID=cid;if(iss==0){$location.path('/assIni/'+teatherID+'/'+kedanID)}else if(iss==1&&issadd==0){$location.path('/assAgain/'+teatherID+'/'+kedanID)}};$scope.CourseList='';$.ajax({type:"post",url:"/orderItem/getCourseListByParent",data:{},datatype:"json",success:function(data){$scope.CourseList=data.object;$scope.CourseListlength=$scope.CourseList.length;$scope.$apply()}});$scope.getCourseDetail=function(Cstate,CID){if(Cstate==0||Cstate==1){$location.path('/LDetai01/'+CID)}else if(Cstate==2||Cstate==3){$location.path('/LDetai03/'+CID)}};$scope.newslist=0;$.ajax({type:"post",url:"/c/chat",data:{},datatype:"json",success:function(data){$scope.newslist=data;$scope.$apply()}})}]).controller('AllClassDeCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var orderItemId=$routeParams.ID;$scope.goback=function(){$location.path('/dynamic/'+2)};$scope.cancelForceStop=function(){$('.HandleState04').fadeOut()};$scope.SubmitRReason=function(Lid){var lessonID=localStorage.getItem('LID');var RReason=$('#RRReason').val();$.ajax({type:"post",url:"/cramLessonItem/rejectCourse",data:{"cramLessonItemId":lessonID,"reason":RReason,},datatype:"json",success:function(data){alert(data.msg);$('.HandleState04').fadeOut();$scope.$apply()}})};$scope.RefuseRefund=function(Lid){$('.HandleState04').fadeIn();localStorage.setItem("LID",Lid)};$scope.confirmLesson=function(Lid){$.ajax({type:"post",url:"/cramLessonItem/confirmCourse",data:{"cramLessonItemId":Lid,},datatype:"json",success:function(data){alert(data.msg);$.ajax({type:"post",url:"/cramLessonItem/getLessonItemListByParent",data:{"orderItemId":orderItemId,},datatype:"json",success:function(data){$scope.LessonItemList=data.object;$scope.LessonItemListlength=$scope.LessonItemList.length;$scope.$apply()}});$scope.$apply()}})};$scope.LessonItemList='';$scope.LessonItemListlength='';$.ajax({type:"post",url:"/cramLessonItem/getLessonItemListByParent",data:{"orderItemId":orderItemId,},datatype:"json",success:function(data){$scope.LessonItemList=data.object;$scope.LessonItemListlength=$scope.LessonItemList.length;$scope.$apply()}});$scope.getCourseDetail=function(Cstate,CID){if(Cstate==0||Cstate==1){$location.path('/LDetai01/'+CID)}else if(Cstate==2||Cstate==3){$location.path('/LDetai03/'+CID)}}}]).controller('LDetai01Ctl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var cramLessonItemId=$routeParams.ID;$scope.goback=function(courserId){$location.path('/AllClassDe/'+courserId)};$scope.cramLessonDetail='';$.ajax({type:"post",url:"/cramLessonItem/getLessonItemByParent",data:{"cramLessonItemId":cramLessonItemId,},datatype:"json",success:function(data){$scope.cramLessonDetail=data.object;console.log(data);$scope.$apply()}})}]).controller('LDetai03Ctl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var cramLessonItemId=$routeParams.ID;$scope.goback=function(courserId){$location.path('/AllClassDe/'+courserId)};$scope.cramLessonDetail='';$.ajax({type:"post",url:"/cramLessonItem/getLessonItemByParent",data:{"cramLessonItemId":cramLessonItemId,},datatype:"json",success:function(data){$scope.cramLessonDetail=data.object;$scope.$apply()}})}]).controller('SingleClassDetailCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var orderItemId=$routeParams.ID;$scope.goback=function(){$location.path('/dynamic/'+2)};$scope.orderIDetail='';$.ajax({type:"post",url:"/orderItem/getCourseInfoByOrderItem",data:{"orderItemId":orderItemId,},datatype:"json",success:function(data){$scope.orderIDetail=data.object;$scope.$apply()}})}])})(angular);