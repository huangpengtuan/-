(function(angular){'use strict';angular.module('Mme',['ngRoute']).directive('onFinishRender',function($timeout){return{restrict:'A',link:function(scope,element,attr){if(scope.$last===true){$timeout(function(){scope.$emit('ngRepeatFinished')})}}}}).config(['$routeProvider',function($routeProvider){$routeProvider.when('/my/',{templateUrl:'me/me.html',controller:'meCtl'}).when('/MyOrders/',{templateUrl:'me/MyOrders.html',controller:'MyOrdersCtl'}).when('/OrderDetails/:ID',{templateUrl:'me/OrderDetails.html',controller:'OrderDetailsCtl'}).when('/RefundDetails/:ID',{templateUrl:'me/RefundDetails.html',controller:'RefundDetailsCtl'}).when('/MyCollect/',{templateUrl:'me/MyCollect.html',controller:'MyCollectCtl'})}]).controller('meCtl',['$scope',function($scope){$scope.avatar='';$scope.name='';$scope.vip_type='';$scope.sex='';$scope.score='';$scope.balance='';$scope.ib_level='';$.post("/p/getMyInfo",{},function(data){$scope.ib_level=data.ib_level;$scope.avatar=data.avatar;$scope.name=data.name;$scope.vip_type=data.vip_type;$scope.sex=data.sex;$scope.score=data.score;$scope.balance=data.balance;$scope.$apply()})}]).controller('MyOrdersCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){tabsfn('SCart-tabs','.SCart-tabs','.SCart-tabs01','SCactive');var cancalReason=document.getElementsByClassName('cancalReason');for(var i=0;i<cancalReason.length;i+=1){cancalReason[i].onclick=function(){var indexx=$('.cancalReason').index($(this));for(var i=0;i<cancalReason.length;i+=1){$('.icon-Uncheck').removeClass('checksActive')}$('.icon-Uncheck').eq(indexx).addClass('checksActive')}}$scope.cancalReasonFadein=function(Oid){$('.cancalState').fadeIn();localStorage.setItem("DeleteOrderId",Oid)};$scope.cancalReasonFadeOut=function(){$('.cancalState').fadeOut()};$scope.goOrderDetails=function(OState,Oid){if(OState==0||OState==1||OState==2||OState==3||OState==4){$location.path('/OrderDetails/'+Oid)}else{$location.path('/RefundDetails/'+Oid)}};$scope.InsureDelete=function(){var Oid=localStorage.getItem("DeleteOrderId");var cancelReason=$('.checksActive').siblings().html();$.ajax({type:"post",url:"/order/cancelOrder",data:{"orderId":Oid,"cancelReason":cancelReason},datatype:"json",success:function(data){$.ajax({type:"post",url:"/order/getOrderListForTeacher",data:{"pageIndex":1,"pageSize":20},datatype:"json",success:function(data){$scope.carmdAllLsits=data.object.list;$scope.$apply()}});$('.cancalState').fadeOut()}})};$scope.carmdAllLsits='';localStorage.setItem("orderStates",'');$.ajax({type:"post",url:"/order/getOrderListForTeacher",data:{"pageIndex":1,"pageSize":20},datatype:"json",success:function(data){$('.spinner').fadeOut();$scope.carmdAllLsits=data.object.list;$scope.$apply()}});var CDtabs=document.getElementsByClassName('MyOrders-tabs');for(var i=0;i<CDtabs.length;i+=1){CDtabs[i].onclick=function(){var indexx=$('.MyOrders-tabs').index($(this));for(var i=0;i<CDtabs.length;i+=1){$('.MyOrders-tabs').removeClass('MOactive');$('.MyOrders-tabs01').removeClass("active")}if(indexx==0){$('.spinner').fadeIn();$.ajax({type:"post",url:"/order/getOrderListForTeacher",data:{"pageIndex":1,"pageSize":20},datatype:"json",success:function(data){$scope.carmdAllLsits=data.object.list;$scope.$apply()}});localStorage.setItem("orderStates",'')}else if(indexx==1||indexx==2||indexx==3){$('.spinner').fadeIn();$.ajax({type:"post",url:"/order/getOrderListForTeacher",data:{"pageIndex":1,"pageSize":20,"status":indexx-1,},datatype:"json",success:function(data){$scope.carmdAllLsits=data.object.list;$scope.$apply()}});localStorage.setItem("orderStates",indexx-1)}pageSizes=20;$('.spinner').fadeOut();$(this).addClass('MOactive');$('.MyOrders-tabs01').eq(indexx).addClass("active")}}var pageSizes=20;$(window).bind("scroll",function(){if($(document).scrollTop()+$(window).height()==$(document).height()){$('.spinner').fadeIn();var orderStates=localStorage.getItem("orderStates");pageSizes+=20;$.ajax({type:"post",url:"/order/getOrderListForTeacher",data:{"pageIndex":1,"pageSize":pageSizes,"status":orderStates,},datatype:"json",success:function(data){$('.spinner').fadeOut();$scope.carmdAllLsits=data.object.list;$scope.$apply()}})}});}]).controller('OrderDetailsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var Oid=$routeParams.ID;$scope.OrderListDetail='';$scope.failureTimeH='';$scope.failureTimeM='';$.ajax({type:"post",url:"/order/getOrderListForTeacher",data:{"orderId":Oid,},datatype:"json",success:function(data){$scope.OrderListDetail=data.object.list[0];$scope.failureTimeH=parseInt(data.object.list[0].failureTime/1000/60/60);$scope.failureTimeM=parseInt(((data.object.list[0].failureTime/1000/60/60)-$scope.failureTimeH)*60);$scope.$apply()}});setInterval(function(){$.ajax({type:"post",url:"/order/getOrderListForTeacher",data:{"orderId":Oid,},datatype:"json",success:function(data){$scope.failureTimeH=parseInt(data.object.list[0].failureTime/1000/60/60);$scope.failureTimeM=parseInt(((data.object.list[0].failureTime/1000/60/60)-$scope.failureTimeH)*60);$scope.$apply()}})},60000);var cancalReason=document.getElementsByClassName('cancalReason');for(var i=0;i<cancalReason.length;i+=1){cancalReason[i].onclick=function(){var indexx=$('.cancalReason').index($(this));for(var i=0;i<cancalReason.length;i+=1){$('.icon-Uncheck').removeClass('checksActive')}$('.icon-Uncheck').eq(indexx).addClass('checksActive')}}$scope.cancalReasonFadein=function(Oid){$('.cancalState').fadeIn();localStorage.setItem("DeleteOrderId",Oid)};$scope.cancalReasonFadeOut=function(){$('.cancalState').fadeOut()};$scope.InsureDelete=function(){var Oid=localStorage.getItem("DeleteOrderId");var cancelReason=$('.checksActive').siblings().html();$.ajax({type:"post",url:"/order/cancelOrder",data:{"orderId":Oid,"cancelReason":cancelReason},datatype:"json",success:function(data){$('.cancalState').fadeOut();alert(data.msg);$.ajax({type:"post",url:"/order/getOrderList",data:{"orderId":Oid,},datatype:"json",success:function(data){$scope.OrderListDetail=data.object.list[0];$scope.$apply()}})}})};$scope.goEvaluate=function(Oid){$location.path('/Evaluate/'+Oid)}}]).controller('RefundDetailsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.forceStop=function(){$('.HandleState02').fadeIn()};$scope.cancelForceStop=function(){$('.HandleState02').fadeOut();$('.HandleState03').fadeOut();$('.HandleState04').fadeOut()};$scope.insureForceStop=function(){$('.HandleState02').fadeOut();$('.HandleState01').fadeIn()};$scope.successForceStop=function(){$('.HandleState01').fadeOut()};$scope.AgreeRefund=function(){$('.HandleState03').fadeIn()};$scope.insureRefund=function(){$('.HandleState03').fadeOut()};$scope.RefuseRefund=function(){$('.HandleState04').fadeIn()};$scope.SubmitRReason=function(){$('.HandleState04').fadeOut()}}]).controller('MyCollectCtl',['$scope',function($scope){$scope.goback=function(){window.history.back()};$scope.CollectList='';$.ajax({type:"post",url:"/favorite/getFavoriteList",data:{},datatype:"json",success:function(data){$scope.CollectList=data.object;console.log(data);$scope.$apply()}});$scope.CollectDelete=function(id){$.ajax({type:"post",url:"/favorite/deleteFavorite",data:{"favoriteId":id},datatype:"json",success:function(data){$.ajax({type:"post",url:"/favorite/getFavoriteList",data:{},datatype:"json",success:function(data){$scope.CollectList=data.object;$scope.$apply()}});scartdelete('.MyCollect-container')}})};$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){scartdelete('.MyCollect-container')})}])})(angular);