(function(angular){'use strict';angular.module('Mnews',['ngRoute']).directive('onFinishRender',function($timeout){return{restrict:'A',link:function(scope,element,attr){if(scope.$last===true){$timeout(function(){scope.$emit('ngRepeatFinished')})}}}}).config(['$routeProvider',function($routeProvider){$routeProvider .when('/news/:ID',{templateUrl:'news/news.html',controller:'newsCtl'}).when('/kedanBegin/:ID',{templateUrl:'kedan/kedanBegin.html',controller:'kedanBeginCtl'}).when('/kedanPreview/',{templateUrl:'kedan/kedanPreview.html',controller:'KDPreviewCtl'}).when('/RequestClass/:ID',{templateUrl:'kedan/RequestClass.html',controller:'RequestClassCtl'}).when('/RCPreview/:ID',{templateUrl:'kedan/RequestClassPreview.html',controller:'RCPreviewCtl'}).when('/kedanDetails/:ID',{templateUrl:'kedan/kedanDetails.html',controller:'kedanDetailsCtl'}).when('/SeeClass/:ID',{templateUrl:'kedan/SeeClass.html',controller:'SeeClassCtl'}).when('/SCDetail/:ID',{templateUrl:'kedan/SeeClassDetails.html',controller:'SCDetailCtl'}).when('/CEnd/:ID',{templateUrl:'kedan/ClassEnd.html',controller:'CEndCtl'}).when('/CEndPre/:ID',{templateUrl:'kedan/ClassEndPreview.html',controller:'CEndPreCtl'}).when('/StopClass/:ID',{templateUrl:'kedan/StopClass.html',controller:'StopClassCtl'}).when('/BeginClass/:ID',{templateUrl:'news/BeginClass.html',controller:'BeginClassCtl'}).when('/ensureClass/:ID',{templateUrl:'news/ensureClass.html',controller:'ensureClassCtl'}).when('/AllClassDe/:ID',{templateUrl:'news/AllClassDe.html',controller:'AllClassDeCtl'}).when('/GLessons/:CID/:LID',{templateUrl:'news/GuitarLessons.html',controller:'GLessonsCtl'}).when('/PreLessons/:CID/:LID',{templateUrl:'news/PreLessons.html',controller:'PreLessonsCtl'}).when('/LDetai01/:ID',{templateUrl:'news/LessonsDetails01.html',controller:'LDetai01Ctl'}).when('/LDetai02/:ID',{templateUrl:'news/LessonsDetails02.html',controller:'LDetai02Ctl'}).when('/LDetai03/:ID',{templateUrl:'news/LessonsDetails03.html',controller:'LDetai03Ctl'}).when('/SingleClassDetail/:ID',{templateUrl:'news/SingleClassDetail.html',controller:'SingleClassDetailCtl'})}]).controller('newsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var state1234=$routeParams.ID;var CDtabs=document.getElementsByClassName('newstabs');for(var i=0;i<CDtabs.length;i+=1){for(var i=0;i<CDtabs.length;i+=1){$('.newstabs').removeClass('yewuactive');$('.newstabs1').removeClass("active")}$('.newstabs').eq(state1234).addClass('yewuactive');$('.newstabs1').eq(state1234).addClass("active")}var PTNumber=1;var PTSize=30;tabsfn('newstabs','.newstabs','.newstabs1','yewuactive');$scope.newslist=0;$.ajax({type:"post",url:"/c/chat",data:{},datatype:"json",success:function(data){$scope.newslist=data;$scope.$apply()}});$scope.zhankai='';$scope.Parentlist='';$.ajax({type:"post",url:"/t/getFriendsByTeacher",data:{"pageNumber":1,"pageSize":30,},datatype:"json",success:function(data){$scope.Parentlist=data.list;$scope.$apply()}});$(window).bind("scroll",function(){if($(document).scrollTop()+$(window).height()==$(document).height()){PTSize+20;$.ajax({type:"post",url:"/t/getFriendsByTeacher",data:{"pageNumber":PTNumber,"pageSize":PTSize,},datatype:"json",success:function(data){$scope.Parentlist=data.list;$scope.$apply()}});EvpageSize+=20;$.ajax({type:"post",url:"/courseEvaluate/getEvaluateList",data:{'schoolId':$scope.buxibanId,'pageIndex':EvpageIndex,'pageSize':EvpageSize},datatype:"json",success:function(data){$scope.EvaluateList=data.object.list;$scope.$apply()}})}});$scope.goWhere=function(id){var ParentID=id;localStorage.setItem("ParentID",ParentID);$.ajax({type:"post",url:"/c/curriculum/getCurriculumDraft",data:{"parentId":ParentID,},datatype:'json',success:function(data){$location.path('/kedanBegin/'+ParentID);$scope.$apply()}})};$scope.kedanlist='';$scope.kedanshow=function(id){var ParentID=id;$.ajax({type:"post",url:"/c/curriculum/getCurriculumList",data:{"pageNumber":1,"pageSize":100,"targetId":ParentID,},datatype:'json',success:function(data){$scope.kedanlist=data.content.list;$scope.$apply()}})};$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){var SingleOnOff=document.getElementsByClassName("showorhide");for(var i=0;i<SingleOnOff.length;i+=1){var a=1;SingleOnOff[i].onclick=function(){a+=1;var indexx=$(".showorhide").index($(this));for(var i=0;i<SingleOnOff.length;i+=1){$(".SingleDetails").slideUp("fast");$(".onoroff-open").addClass("opentxt");$(".onoroff-Close").removeClass("opentxt");$(".Billing").removeClass("Billinghide");$('.showorhide').removeClass("showorhide-active")}if(a%2==0){$(".SingleDetails").eq(indexx).stop(true,false).slideToggle("slow");$(".onoroff-open").eq(indexx).toggleClass("opentxt");$(".onoroff-Close").eq(indexx).toggleClass("opentxt");$(".Billing").eq(indexx).toggleClass("Billinghide");$('.showorhide').eq(indexx).toggleClass("showorhide-active")}}}});$scope.stateChange=function(id,state){var kedanID=id;var states=state;$.ajax({type:"post",url:"/c/curriculum/updateCurriculumState",data:{"currId":kedanID,"stateCode":states,},datatype:"json",success:function(data){window.location.reload()}})};$scope.CramData='';$scope.CramStates='';$scope.CramText='';$scope.stars='';$scope.groups1='';$scope.buxibanId='';$scope.groupcurri='';$scope.starslistA=[];var starsI='';$scope.quality_score='';$scope.quality_score01='';$scope.service_score='';$scope.service_score01='';var EvpageSize=20;var EvpageIndex=1;$scope.EvaluateList='';$scope.totalRow='';$scope.dianbustates=function(){$.ajax({type:"post",url:"/cramSchool/getCramSchoolState",data:{},datatype:"json",success:function(data){$scope.CramData=data.object;if($scope.CramData){$scope.buxibanId=data.object.id;$scope.quality_score=data.object.quality_score;$scope.service_score=data.object.service_score;if($scope.quality_score*10%10<=2&&$scope.quality_score*10%10!=0){$scope.quality_score01='img/start2.png'}else if($scope.quality_score*10%10<=5&&$scope.quality_score*10%10!=0){$scope.quality_score01='img/start5.png'}else if($scope.quality_score*10%10<=9&&$scope.quality_score*10%10!=0){$scope.quality_score01='img/start8.png'}else if($scope.quality_score==5){$scope.quality_score01='img/start10.png'}else{$scope.quality_score01='img/start0.png'}if($scope.service_score*10%10<=2&&$scope.service_score*10%10!=0){$scope.service_score01='img/start2.png'}else if($scope.service_score*10%10<=5&&$scope.service_score*10%10!=0){$scope.service_score01='img/start5.png'}else if($scope.service_score*10%10<=9&&$scope.service_score*10%10!=0){$scope.service_score01='img/start8.png'}else if($scope.service_score==5){$scope.service_score01='img/start10.png'}else{$scope.service_score01='img/start0.png'}$scope.groups1=data.object.groups[0];if($scope.CramData.eva_star*10%10<=2&&$scope.CramData.eva_star*10%10!=0){$scope.stars='img/start2.png'}else if($scope.CramData.eva_star*10%10<=5&&$scope.CramData.eva_star*10%10!=0){$scope.stars='img/start5.png'}else if($scope.CramData.eva_star*10%10<=9&&$scope.CramData.eva_star*10%10!=0){$scope.stars='img/start8.png'}else if($scope.CramData.eva_star==5){$scope.stars='img/start10.png'}else{$scope.stars='img/start0.png'}}if(!$scope.CramData){$scope.CramStates='icon-Establish';$scope.CramText='您还没有班级，赶紧创建一个，成为班主任吧';$('#ApplyState').show();$('#CDetails').hide()}else if(data.object.state==1){$scope.CramStates='icon-examineing';$scope.CramText='您未支付补习班保证金，请尽快支付';$('#ApplyState').show();$('#CDetails').hide()}else if(data.object.state==2){$scope.CramStates='icon-examineing';$scope.CramText='您的申请已提交，项目经理将尽快审核，请耐心等候';$('#ApplyState').show();$('#CDetails').hide()}else if(data.object.state==4){$scope.CramStates='icon-examine-not';$scope.CramText='您没有通过第壹家教补习班申请资格。保证金将退还到您的账户余额。七天之后可以再次申请哦!';$('#ApplyState').show();$('#CDetails').hide()}else if(data.object.state==3){$('#ApplyState').hide();$('#CDetails').show();$.ajax({type:"post",url:"/cramCourse/getCramCourse",data:{"schoolId":$scope.groups1.cramSchoolId,"groupId":$scope.groups1.id,},datatype:"json",success:function(data){$scope.groupcurri=data.object.list;if($scope.groupcurri[0].composite_score*10%10<=2&&$scope.groupcurri[0].composite_score*10%10!=0){starsI='img/start2.png'}else if($scope.groupcurri[0].composite_score*10%10<=5&&$scope.groupcurri[0].composite_score*10%10!=0){starsI='img/start5.png'}else if($scope.groupcurri[0].composite_score*10%10<=9&&$scope.groupcurri[0].composite_score*10%10!=0){starsI='img/start8.png'}else if($scope.groupcurri[0].composite_score==5){starsI='img/start10.png'}else{starsI='img/start0.png'}$scope.starslistA.push(starsI);$scope.$apply()}})}$.ajax({type:"post",url:"/courseEvaluate/getEvaluateList",data:{'schoolId':$scope.buxibanId,'pageIndex':1,'pageSize':20},datatype:"json",success:function(data){$scope.totalRow=data.object.totalRow;$scope.EvaluateList=data.object.list;$scope.$apply()}});$scope.$apply()}})};$scope.dianbustates();$scope.Cramgowhere=function(a){var craminfo=a;if(!a){$location.path('/applycram/')}else if(a.state==1){$location.path('/applycram/')}};tabsfn('CDtabs','.CDtabs','.CDtabs1','CDactive');$('.Plus').click(function(){$(this).toggleClass('Plus-active');$('.SetUp').toggleClass('SetUpAnimate')});$('.SetUp-child').click(function(){$(this).addClass('tabItemactive');setTimeout(function(){$('.SetUp').removeClass('SetUpAnimate');$('.SetUp-child').removeClass('tabItemactive')},500)});$scope.fgcurri=function(schoolId,groupID,$event){var groupID=groupID;var schoolId=schoolId;$scope.starslistA=[];$.ajax({type:"post",url:"/cramCourse/getCramCourse",data:{"schoolId":schoolId,"groupId":groupID,},datatype:"json",success:function(data){$scope.groupcurri=data.object.list;for(var i=0;i<$scope.groupcurri.length;i+=1){if($scope.groupcurri[i].composite_score*10%10<=2&&$scope.groupcurri[i].composite_score*10%10!=0){starsI='img/start2.png'}else if($scope.groupcurri[i].composite_score*10%10<=5&&$scope.groupcurri[i].composite_score*10%10!=0){starsI='img/start5.png'}else if($scope.groupcurri[i].composite_score*10%10<=9&&$scope.groupcurri[i].composite_score*10%10!=0){starsI='img/start8.png'}else if($scope.groupcurri[i].composite_score==5){starsI='img/start10.png'}else{starsI='img/start0.png'}$scope.starslistA.push(starsI)}$scope.$apply()}});$('.tabBody').removeClass('tabItemactive');$($event.target).addClass("tabItemactive")};$scope.gocurriculum=function(curriID){$location.path('/curriculum/'+curriID)};$scope.LessonsList='';$scope.getmyLessons=function(){$.ajax({type:"post",url:"/cramCourse/getCourseByTeacher",data:{},datatype:"json",success:function(data){$scope.LessonsList=data.object;$scope.$apply()}});localStorage.setItem('order_items','');localStorage.setItem('items_number','');localStorage.setItem('attend_class_hour','');localStorage.setItem('course_date','');localStorage.setItem('course_time','');localStorage.setItem('over_time','');localStorage.setItem('address','');localStorage.setItem('plan','')};$scope.getmyLessons()}]).controller('kedanBeginCtl',['$scope',function($scope){$scope.kedanStart=function(){var KDdata=$("form").serializeArray();localStorage.setItem("type",KDdata[0].value);localStorage.setItem("studentName",KDdata[1].value);localStorage.setItem("subjectId",KDdata[2].value);localStorage.setItem("grade",KDdata[3].value);localStorage.setItem("hourSubsidy",KDdata[4].value);localStorage.setItem("totalHours",KDdata[5].value);localStorage.setItem("frequency",KDdata[6].value);localStorage.setItem("place",KDdata[7].value);localStorage.setItem("address",KDdata[8].value);localStorage.setItem("penalty",KDdata[9].value);localStorage.setItem("memo",KDdata[10].value)}}]).controller('KDPreviewCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var ParentID=window.localStorage.getItem("ParentID");var type=window.localStorage.getItem("type");$scope.type='';if(type==1){$scope.type='常规课程'}$scope.studentName=window.localStorage.getItem("studentName");var subjectId=window.localStorage.getItem("subjectId");$scope.subjectId='';if(subjectId==2){$scope.subjectId='小学/全科'}else if(subjectId==3){$scope.subjectId='小学/语文'}else if(subjectId==4){$scope.subjectId='小学/数学'}else if(subjectId==5){$scope.subjectId='小学/英语'}else if(subjectId==7){$scope.subjectId='初中/全科'}else if(subjectId==8){$scope.subjectId='初中/语文'}else if(subjectId==9){$scope.subjectId='初中/数学'}else if(subjectId==10){$scope.subjectId='初中/英语'}else if(subjectId==11){$scope.subjectId='初中/物理'}else if(subjectId==12){$scope.subjectId='初中/地理'}else if(subjectId==13){$scope.subjectId='初中/生物'}else if(subjectId==14){$scope.subjectId='初中/化学'}else if(subjectId==15){$scope.subjectId='初中/历史'}else if(subjectId==16){$scope.subjectId='初中/政治'}else if(subjectId==18){$scope.subjectId='高中/全科'}else if(subjectId==19){$scope.subjectId='高中/语文'}else if(subjectId==20){$scope.subjectId='高中/数学'}else if(subjectId==21){$scope.subjectId='高中/英语'}else if(subjectId==22){$scope.subjectId='高中/物理'}else if(subjectId==23){$scope.subjectId='高中/地理'}else if(subjectId==24){$scope.subjectId='高中/生物'}else if(subjectId==25){$scope.subjectId='高中/化学'}else if(subjectId==26){$scope.subjectId='高中/历史'}else if(subjectId==27){$scope.subjectId='高中/政治'}$scope.grade=window.localStorage.getItem("grade");$scope.hourSubsidy=window.localStorage.getItem("hourSubsidy");$scope.totalHours=window.localStorage.getItem("totalHours");$scope.frequency=window.localStorage.getItem("frequency");var place=window.localStorage.getItem("place");$scope.place='';if(place==1){$scope.place='学生家中'}else if(place==2){$scope.place='老师家中'}else if(place==3){$scope.place='双方约定地点'}$scope.totalMoney=$scope.hourSubsidy*$scope.totalHours;$scope.address=window.localStorage.getItem("address");var penalty=window.localStorage.getItem("penalty");$scope.weiyuejin='';if(penalty){$scope.weiyuejin=penalty*$scope.totalMoney/100}else{$scope.weiyuejin=0}$scope.memo=window.localStorage.getItem("memo");$scope.time=new Date().getTime();$scope.goback=function(){$location.path('/kedanBegin/'+ParentID)};$scope.OKStart=function(){$.ajax({type:"post",url:"/c/curriculum/creatCurriculum",data:{"c.target_id":ParentID,"c.type":type,"c.student_name":$scope.studentName,"c.subject_id":subjectId,"c.grade":$scope.grade,"c.hour_subsidy":$scope.hourSubsidy,"c.total_hours":$scope.totalHours,"c.frequency":$scope.frequency,"c.place":place,"c.address":$scope.address,"c.penalty":penalty,"c.memo":$scope.memo,},datatype:'json',success:function(data){alert("课单发送成功，等待家长确认。");$location.path('/news/'+1);$scope.$apply()}})}}]).controller('RequestClassCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.currId=$routeParams.ID;$scope.surplusHouer='';$.ajax({type:"post",url:"/c/curriculum/getCurriculumInfo",data:{"currId":$scope.currId,},datatype:"json",success:function(data){$scope.surplusHouer=data.object.surplusHouer;$scope.$apply()}});$scope.startClass=function(){var classlists=$("form").serializeArray();localStorage.setItem("classHour",classlists[0].value);localStorage.setItem("appDate",classlists[1].value);localStorage.setItem("TimeStard",classlists[2].value);localStorage.setItem("TimeEnd",classlists[3].value);localStorage.setItem("place",classlists[4].value);localStorage.setItem("address",classlists[5].value);localStorage.setItem("plan",classlists[6].value)}}]).controller('RCPreviewCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.currId=$routeParams.ID;$scope.classHour=window.localStorage.getItem("classHour");$scope.appDate=window.localStorage.getItem("appDate");$scope.TimeStard=window.localStorage.getItem("TimeStard");$scope.TimeEnd=window.localStorage.getItem("TimeEnd");var placestate=window.localStorage.getItem("place");$scope.place='';if(placestate==1){$scope.place='学生家中'}else if(placestate==2){$scope.place='老师家中'}else if(placestate==3){$scope.place='双方约定地点'}$scope.address=window.localStorage.getItem("address");$scope.plan=window.localStorage.getItem("plan");$scope.time=new Date().getTime();$scope.submitClass=function(){$.ajax({type:"post",url:"/c/curriculumClass/saveClass",data:{"currId":$scope.currId,"c.class_hour":$scope.classHour,"c.class_begin_date":$scope.appDate,"c.class_begin_time":$scope.TimeStard,"c.class_over_time":$scope.TimeEnd,"c.place":placestate,"c.address":$scope.address,"c.plan":$scope.plan,},datatype:"json",success:function(data){alert("课次已成功发送");$location.path('/SeeClass/'+$scope.currId);$scope.$apply()}})}}]).controller('kedanDetailsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var currId=$routeParams.ID;$scope.typeText='';$scope.studentName='';$scope.subjectText='';$scope.grade='';$scope.hour_subsidy='';$scope.total_hours='';$scope.frequency='';$scope.placeText='';$scope.address='';$scope.order_amount='';$scope.penaltyAmount='';$scope.in_time='';$scope.memo='';$scope.state='';$scope.currId=currId;$.ajax({type:"post",url:"/c/curriculum/getCurriculumInfo",data:{"currId":currId},datatype:"json",success:function(data){$scope.typeText=data.object.typeText;$scope.studentName=data.object.student_name;$scope.subjectText=data.object.subjectText;$scope.grade=data.object.grade;$scope.hour_subsidy=data.object.hour_subsidy;$scope.total_hours=data.object.total_hours;$scope.frequency=data.object.frequency;$scope.placeText=data.object.placeText;$scope.address=data.object.address;$scope.order_amount=data.object.order_amount;$scope.penaltyAmount=data.object.penaltyAmount;$scope.in_time=data.object.in_time;$scope.memo=data.object.memo;$scope.state=data.object.state;$scope.$apply()}});$scope.stateChange=function(state){var states=state;$.ajax({type:"post",url:"/c/curriculum/updateCurriculumState",data:{"currId":currId,"stateCode":states,},datatype:"json",success:function(data){$location.path('/news/'+1);$scope.$apply()}})}}]).controller('SeeClassCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var currId=$routeParams.ID;$scope.keciList='';$.ajax({type:"post",url:"/c/curriculumClass/getClassListBycurr",data:{"currId":currId,},datatype:"json",success:function(data){$scope.keciList=data.object;console.log(data);$scope.$apply()}});$scope.Report=function(id,report){var classId=id;var reports=report;console.log(classId);console.log(reports);if(reports){$location.path('/CEndPre/'+classId)}else{$location.path('/CEnd/'+classId)}}}]).controller('SCDetailCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var classId=$routeParams.ID;$.ajax({type:"post",url:"/c/curriculumClass/getClassInfo",data:{"classId":classId,},datatype:"json",success:function(data){$scope.kecis=data.object;$scope.$apply()}});$scope.cancelClass=function(kedanID){var currId=kedanID;$.ajax({type:"post",url:"/c/curriculumClass/cancelClass",data:{"classId":classId,},datatype:"json",success:function(data){$location.path('/SeeClass/'+currId);$scope.$apply()}})}}]).controller('CEndCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.classId=$routeParams.ID;$scope.class_hour='';$.ajax({type:"post",url:"/c/curriculumClass/getClassInfo",data:{"classId":$scope.classId,},datatype:"json",success:function(data){$scope.class_hour=data.object.class_hour;$scope.$apply()}});$scope.SCEnd=function(){var SCReport=$("form").serializeArray();localStorage.setItem("CHour",SCReport[0].value);localStorage.setItem("appDate1",SCReport[1].value);localStorage.setItem("TimeStard1",SCReport[2].value);localStorage.setItem("TimeEnd1",SCReport[3].value);localStorage.setItem("report",SCReport[4].value)}}]).controller('CEndPreCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.classId=$routeParams.ID;$scope.CHour='';$scope.appDate1='';$scope.TimeStard1='';$scope.TimeEnd1='';$scope.report='';$scope.plan='';$scope.totalMN='';$scope.currId='';$.ajax({type:"post",url:"/c/curriculumClass/getClassInfo",data:{"classId":$scope.classId,},datatype:"json",success:function(data){if(data.object.report){$scope.CHour=data.object.class_hour;$scope.appDate1=data.object.class_begin_date;$scope.TimeStard1=data.object.class_begin_time;$scope.TimeEnd1=data.object.class_over_time;$scope.report=data.object.report}else if(!data.object.report){$scope.CHour=window.localStorage.getItem("CHour");$scope.appDate1=window.localStorage.getItem("appDate1");$scope.TimeStard1=window.localStorage.getItem("TimeStard1");$scope.TimeEnd1=window.localStorage.getItem("TimeEnd1");$scope.report=window.localStorage.getItem("report")}$scope.currId=data.object.curriculum_id;$scope.totalMN=$scope.CHour*data.object.hourSubsidy;$scope.plan=data.object.plan;$scope.currId=data.object.curriculum_id;$scope.$apply()}});$scope.CreateReport=function(currId){var currId=currId;$.ajax({type:"post",url:"/c/curriculumClass/reportClass",data:{"classId":$scope.classId,"c.class_hour":$scope.CHour,"c.class_begin_date":$scope.appDate1,"c.class_begin_time":$scope.TimeStard1,"c.class_over_time":$scope.TimeEnd1,"c.report":$scope.report,},datatype:"json",success:function(data){alert("结课报告已发送，请耐心等待家长确认");$location.path('/SeeClass/'+currId);$scope.$apply()}})}}]).controller('StopClassCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var currId=$routeParams.ID;$scope.submitResure=function(){var resure=$("textarea").val();if(resure){$.ajax({type:"post",url:"/c/curriculum/updateCurriculumState",data:{"currId":currId,"stateCode":11,"stopReason":resure,},datatype:"json",success:function(data){alert("协商请求已发送，请耐心等待家长回复");$location.path('/news/'+1);$scope.$apply()}})}else{alert("请填写您中止的原因")}}}]).controller('BeginClassCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var courseId=$routeParams.ID;$scope.order_items=localStorage.getItem('order_items');$scope.items_number=localStorage.getItem('items_number').replace(/[^0-9]/ig,"");$scope.attend_class_hour=localStorage.getItem('attend_class_hour');$scope.course_date=localStorage.getItem('course_date');$scope.course_time=localStorage.getItem('course_time');$scope.over_time=localStorage.getItem('over_time');$scope.address=localStorage.getItem('address');$scope.plan=localStorage.getItem('plan');$scope.studentlist='';$scope.Sestudents=function(){$('#BeginClass').fadeOut();$.ajax({type:"post",url:"/cramLesson/findStudentInfos",data:{"courseId":courseId,},datatype:"json",success:function(data){$scope.studentlist=data.object;$scope.$apply()}});$('#Sestudents').fadeIn()};$scope.cancelSelect=function(){$('#Sestudents').fadeOut();$('#BeginClass').fadeIn()};$scope.ensureSelect=function(){$('#Sestudents').fadeOut();$('#sele-students').val($('.Ses-tabs-L').html());$('#BeginClass').fadeIn()};$scope.checkmountStu=0;$scope.SeAllStudents=function(){if($('.BC-checkAll').hasClass('checksActiveAll')){$('.BC-checkAll').removeClass('checksActiveAll');$('.BC-check01').removeClass('checksActive');$('.BC-listTop').removeClass('BC-active');$scope.checkmountStu=0;studentsIDList=[]}else if(!$('.BC-checkAll').hasClass('checksActiveAll')){$('.BC-checkAll').addClass('checksActiveAll');$('.BC-check01').addClass('checksActive');$('.BC-listTop').addClass('BC-active');$scope.checkmountStu=$('.checksActive').length;var SeStu01=document.getElementsByClassName("BC-check01");for(var i=0;i<SeStu01.length;i+=1){studentsIDList.push($('.BC-check01').eq(i).attr('data-studentID'))}}};var studentsIDList=[];$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){var SeStu=document.getElementsByClassName("BC-check01");for(var i=0;i<SeStu.length;i+=1){SeStu[i].onclick=function(){var indexx=$(".BC-check01").index($(this));$(this).toggleClass('checksActive');$('.BC-listTop').eq(indexx).toggleClass('BC-active');$scope.checkmountStu=$('.checksActive').length;studentsIDList.push($(this).attr('data-studentID'));$scope.$apply()}}});$scope.generateLessons=function(){var LessonsText=$('#BC-data').serializeArray();localStorage.setItem('order_items',studentsIDList);localStorage.setItem('items_number',LessonsText[0].value);localStorage.setItem('attend_class_hour',LessonsText[1].value);localStorage.setItem('course_date',LessonsText[2].value);localStorage.setItem('course_time',LessonsText[3].value);localStorage.setItem('over_time',LessonsText[4].value);localStorage.setItem('address',LessonsText[5].value);localStorage.setItem('plan',LessonsText[6].value);$location.path('/ensureClass/'+courseId)}}]).controller('ensureClassCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){$scope.courseId=$routeParams.ID;$scope.order_items=localStorage.getItem('order_items').toString();$scope.items_number=localStorage.getItem('items_number').replace(/[^0-9]/ig,"");$scope.attend_class_hour=localStorage.getItem('attend_class_hour');$scope.course_date=localStorage.getItem('course_date');$scope.course_time=localStorage.getItem('course_time');$scope.over_time=localStorage.getItem('over_time');$scope.address=localStorage.getItem('address');$scope.plan=localStorage.getItem('plan');$scope.submitClass=function(){$.ajax({type:"post",url:"/cramLesson/createLesson",data:{"le.courser_id":$scope.courseId,"le.order_items":$scope.order_items,"le.attend_class_hour":$scope.attend_class_hour,"le.course_date":$scope.course_date,"le.course_time":$scope.course_time,"le.over_time":$scope.over_time,"le.address":$scope.address,"le.plan":$scope.plan,},datatype:"json",success:function(data){alert(data.msg);$location.path('/AllClassDe/'+$scope.courseId);$scope.$apply()}})}}]).controller('AllClassDeCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var courseId=$routeParams.ID;localStorage.setItem('items_number','');localStorage.setItem('attend_class_hour','');localStorage.setItem('course_date','');localStorage.setItem('course_time','');localStorage.setItem('over_time','');localStorage.setItem('report','');$scope.goback=function(){$location.path('/news/'+2)};$scope.lessonchildsList='';$.ajax({type:"post",url:"/cramLesson/getLessonListByCourse",data:{"courseId":courseId,},datatype:"json",success:function(data){$scope.lessonchildsList=data.object;$scope.$apply()}});$scope.goLessonchildDetail=function(state,id){if(state==0){$location.path('/LDetai01/'+id)}else if(state==1){$location.path('/LDetai02/'+id)}else if(state==2){$location.path('/LDetai03/'+id)}}}]).controller('GLessonsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var courseId=$routeParams.CID;var lessonId=$routeParams.LID;$scope.goback=function(){window.history.back()};$scope.order_items=localStorage.getItem('order_items').toString();$scope.items_number=localStorage.getItem('items_number');$scope.course_time=localStorage.getItem('course_time');$scope.over_time=localStorage.getItem('over_time');$scope.plan=localStorage.getItem('report');$scope.studentlist='';$scope.Sestudents=function(){$('.GuitarLessons').fadeOut();$.ajax({type:"post",url:"/cramLesson/findStudentInfos",data:{"courseId":courseId,},datatype:"json",success:function(data){$scope.studentlist=data.object;$scope.$apply()}});$('#Sestudents').fadeIn()};$scope.cancelSelect=function(){$('#Sestudents').fadeOut();$('.GuitarLessons').fadeIn()};$scope.ensureSelect=function(){$('#Sestudents').fadeOut();$('#sele-students').val($('.Ses-tabs-L').html());$('.GuitarLessons').fadeIn()};$scope.checkmountStu=0;$scope.SeAllStudents=function(){if($('.BC-checkAll').hasClass('checksActiveAll')){$('.BC-checkAll').removeClass('checksActiveAll');$('.BC-check01').removeClass('checksActive');$('.BC-listTop').removeClass('BC-active');$scope.checkmountStu=0;studentsIDList=[]}else if(!$('.BC-checkAll').hasClass('checksActiveAll')){$('.BC-checkAll').addClass('checksActiveAll');$('.BC-check01').addClass('checksActive');$('.BC-listTop').addClass('BC-active');$scope.checkmountStu=$('.checksActive').length;var SeStu01=document.getElementsByClassName("BC-check01");for(var i=0;i<SeStu01.length;i+=1){studentsIDList.push($('.BC-check01').eq(i).attr('data-studentID'))}}};var studentsIDList=[];$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){var SeStu=document.getElementsByClassName("BC-check01");for(var i=0;i<SeStu.length;i+=1){SeStu[i].onclick=function(){var indexx=$(".BC-check01").index($(this));$(this).toggleClass('checksActive');$('.BC-listTop').eq(indexx).toggleClass('BC-active');$scope.checkmountStu=$('.checksActive').length;studentsIDList.push($(this).attr('data-studentID'));$scope.$apply()}}});$scope.PreReport=function(){var LessonsText=$('#BC-data').serializeArray();localStorage.setItem('order_items',studentsIDList);localStorage.setItem('items_number',LessonsText[0].value);localStorage.setItem('attend_class_hour',LessonsText[1].value);localStorage.setItem('course_date',LessonsText[2].value);localStorage.setItem('course_time',LessonsText[3].value);localStorage.setItem('over_time',LessonsText[4].value);localStorage.setItem('report',LessonsText[5].value);$location.path('/PreLessons/'+courseId+'/'+lessonId)}}]).controller('PreLessonsCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var courseId=$routeParams.CID;var lessonId=$routeParams.LID;$scope.goback=function(){window.history.back()};$scope.order_items=localStorage.getItem('order_items').toString();$scope.items_number=localStorage.getItem('items_number').replace(/[^0-9]/ig,"");$scope.attend_class_hour=localStorage.getItem('attend_class_hour');$scope.course_date=localStorage.getItem('course_date');$scope.course_time=localStorage.getItem('course_time');$scope.over_time=localStorage.getItem('over_time');$scope.report=localStorage.getItem('report');$scope.lessonPlan='';$.ajax({type:"post",url:"/cramLesson/getLessons",data:{"cramLessonsId":lessonId,},datatype:"json",success:function(data){$scope.lessonPlan=data.object.plan;$scope.$apply()}});$scope.CreateReport=function(){$.ajax({type:"post",url:"/cramLesson/sponsorFinishClass",data:{"cramLessonId":lessonId,'le.order_items':$scope.order_items,'le.attend_class_hour':$scope.attend_class_hour,'le.course_date':$scope.course_date,'le.course_time':$scope.course_time,'le.over_time':$scope.over_time,'le.report':$scope.report,},datatype:"json",success:function(data){alert(data.msg);if(data.isSuccess){$location.path('/AllClassDe/'+courseId)}$scope.$apply()}})}}]).controller('LDetai01Ctl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var cramLessonsId=$routeParams.ID;$scope.goback=function(courserId){$location.path('/AllClassDe/'+courserId)};$scope.cramLessondata='';$.ajax({type:"post",url:"/cramLesson/getLessons",data:{"cramLessonsId":cramLessonsId,},datatype:"json",success:function(data){$scope.cramLessondata=data.object;$scope.$apply()}})}]).controller('LDetai02Ctl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var cramLessonId=$routeParams.ID;$scope.goback=function(courserId){$location.path('/AllClassDe/'+courserId)};$scope.UnconfirmedStudent='';$scope.Sestudents=function(){$('.LessonsDet').fadeOut();$.ajax({type:"post",url:"/cramLesson/getUnconfirmedStudentList",data:{"cramLessonId":cramLessonId,},datatype:"json",success:function(data){$scope.UnconfirmedStudent=data.object;$scope.$apply()}});$('#Sestudents').fadeIn()};$scope.rejectStudent='';$scope.Sestudents01=function(){$('.LessonsDet').fadeOut();$.ajax({type:"post",url:"/cramLesson/rejectStudentList",data:{"cramLessonId":cramLessonId,},datatype:"json",success:function(data){$scope.rejectStudent=data.object;$scope.$apply()}});$('#Sestudents01').fadeIn()};var rejectStudentIDList=[];$scope.cancelSelect=function(){$('#Sestudents').fadeOut();$('#Sestudents01').fadeOut();$('.LessonsDet').fadeIn();rejectStudentIDList=[]};var rejectStudentIDList=[];$scope.$on('ngRepeatFinished',function(ngRepeatFinishedEvent){var SeStu=document.getElementsByClassName("BC-check01");for(var i=0;i<SeStu.length;i+=1){SeStu[i].onclick=function(){var indexx=$(".BC-check01").index($(this));$(this).toggleClass('checksActive');$('.BC-listTop').eq(indexx).toggleClass('BC-active');$scope.checkmountStu=$('.checksActive').length;rejectStudentIDList.push($(this).attr('data-RStudentId'));$scope.$apply()}}});$scope.GuitarAgain=function(Lid){$.ajax({type:"post",url:"/cramLesson/againFinishClass",data:{"cramLessonId":Lid,"cramLessonItemIds":rejectStudentIDList.toString(),},datatype:"json",success:function(data){alert(data.msg);if(data.isSuccess){$('#Sestudents01').fadeOut()}}})};$scope.cramLessondata='';$.ajax({type:"post",url:"/cramLesson/getLessons",data:{"cramLessonsId":cramLessonId,},datatype:"json",success:function(data){$scope.cramLessondata=data.object;$scope.$apply()}})}]).controller('LDetai03Ctl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var cramLessonsId=$routeParams.ID;$scope.goback=function(courserId){$location.path('/AllClassDe/'+courserId)};$scope.cramLessondata='';$scope.lessonPlan='';$.ajax({type:"post",url:"/cramLesson/getLessons",data:{"cramLessonsId":cramLessonsId,},datatype:"json",success:function(data){$scope.cramLessondata=data.object;$scope.$apply()}})}]).controller('SingleClassDetailCtl',['$scope','$route','$location','$routeParams',function($scope,$route,$location,$routeParams){var courseId=$routeParams.ID;$scope.goback=function(){window.history.back()};$scope.SingleClassinfo='';$.ajax({type:"post",url:"/cramCourse/getCourse",data:{"courseId":courseId,},datatype:"json",success:function(data){$scope.SingleClassinfo=data.object;$scope.$apply()}})}])})(angular);